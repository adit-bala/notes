# Running a Program (Compiling, Assembling, Linking, Loading)

## Pseudo instructions

- Convenient variations of instructions understood by the assembler, but not by the machine

![pseudo_instr](img/pseudo_instr.png)

## How do we run a C program

- **Translator**: Converts a program from the source language to an equivalent program in another language
    - almost always mean higher efficiency, higher performance
- Contrast with **Interpreter**: Directly executes a program in the source language
    - Note: C programs/RISC-V can also be interpreted!
    - Example : Venus RISC-V simulator useful for learning/debugging

## Steps in compiling and running a C program
![steps_compile_run](img/steps_compile_run.png)

## Compiler
![compiler](img/compiler.png)

## Assembler
![assembler](img/assembler.png)

## Directives
- gives directions to the assembler
- often generated by the compiler
- do not produce machine instructions, rather they inform how to build diff parts of the *object file*
![directives](img/directives.png)

## Object File Format

### 1/3

1. **Object File Header**: size and position of other pieces of the object file
2. **Text Segment**: machine code
3. **Data Segment**: binary representation of static data in the source file

### Producing Machine Code

#### Simple Case
- Arithmetic, Logical, Shifts, etc.
![simple_case](img/simple_case.png)
- PC-Relative Branches and Jumps
![relative_branches_jumps](img/relative_branches_jumps.png)

#### Two-Pass
![two_pass](img/two_pass.png)

#### What about Other References?
![other_references](img/other_references.png)

### 2/3

#### Object File Format
4. **Symbol Table**: List of file's labels, static data that can be referenced by other programs
5. **Relocation Information**: Lines of code to fix later (by Linker)

#### Symbol Table
- List of "items" in the file
- Instruction **Labels**
    - Used to compute machine code for PC-relative addressing in branches, function calling, etc.
    - .global direction: labels can be reference by other files
- **Data**: anything in the **.data** section
    - Global variables may be accessed/used by other files

#### Relocation Information
![relocation_information](img/relocation_information.png)

### 3/3

## Object File Format
![3_3_object](img/3_3_object.png)

## Linker

![linker](img/linker.png)

### patching together multiple object modules
![image_2023-02-15-10-44-20](img/image_2023-02-15-10-44-20.png)

### Which Address Needs Relocating
![which_relocate](img/which_relocate.png)

### Which Instructions Need Relocation Editing
![inst_relocation_editing](img/inst_relocation_editing.png)

## Resolving References

### 1/2

![rr_12](img/rr_12.png)
- low length of each segment due to the header

### 2/2

![rr_22](img/rr_22.png)

## Static vs Dynamic Linking
![s_vs_d](img/s_vs_d.png)

## Dynamically-Linked Libraries
![DLL](img/DLL.png)

## Loader
![loader](img/loader.png)

## What does it do
![loader_what_does_it_do](img/loader_what_does_it_do.png)

